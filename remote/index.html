<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Remote</title>
    <link rel="stylesheet" type="text/css" href="joy.css" />
</head>
<body>
<div id="top">
    <div id="container"></div>
</div>
<div id="bottom">
    <div id="buttons">
        <span id="button-a" class='video-game-button' ontouchstart="aDown()" ontouchend="aUp()" onmousedown="aDown()" onmouseup="aUp()">A</span>
        <span id="button-b" class='video-game-button' ontouchstart="bDown()" ontouchend="bUp()" onmousedown="bDown()" onmouseup="bUp()">B</span>
    </div>
</div>
<script src="./virtualjoystick.js"></script>
<script>
    let url = "ws://wall.ulimartech.com:3400/";
    let webSocket = new WebSocket(url);
    webSocket.onopen = function(event){
	    webSocket.send("snake");
    }
    webSocket.onerror = function(event){
	    alert("error");
    }
    webSocket.onclose = function(event){
	    alert("closed");
    }



    let joystick	= new VirtualJoystick({
	container	: document.getElementById('container'),
	mouseSupport	: true,
    });
    let aPressed = false;
    let bPressed = false;
    joystick.addEventListener('touchStart', function(){
	console.log('down')
    });
    joystick.addEventListener('touchEnd', function(){
	console.log('up')
    });

    setInterval(function(){
	let press = '';
	if(joystick.right())
	    press = 'right';
	if (joystick.up())
	    press += ' up';
	if (joystick.left())
	    press += ' left';
	if (joystick.down())
	    press += ' down';
	
	if(aPress()){
	    press += ' a';
	}
	if(bPress()){
	    press +=' b';
	}

	if(press != ''){
	    console.log(press);
	    webSocket.send(press);
	}
    }, 1/3 * 1000);
    function aDown() {
        aPressed = true;
    }
    function aUp() {
        aPressed = false;
    }
    function bDown() {
        aPressed = true;
    }
    function bUp() {
        aPressed = false;
    }
    function aPress() {

        return aPressed;
    }
    function bPress() {
        return bPressed;
    }
</script>
</body>
</html>
